---
title: "Alternative trails"
author: "Carlos CÃ¡mara"
date: "24/3/2022"
output: html_document
---

```{r setup, include=FALSE}
library(htmltools)
library(htmlwidgets)
library(leaflet)
library(leaflet.extras)

# Load data
df <- read.csv("data/alternative_trails_data.csv") 

df$category <- as.factor(df$category)

# place <- photon::geocode(df$address, limit = 1, key = "place") 
# place$id <- rownames(place)

col_green <- "#258001"
col_purple <- "#9b009a"
```


### Interactive map

```{r}

getColor <- function(df) {
  sapply(df$category, function(category) {
  if(category == "Organisations") {
    "green"
  } else if(category == "Whatever") {
    "blue"
  } else {
    "purple"
  } })
}

# icons <- awesomeIcons(
#   icon = 'fa-arrows-to-circle',
#   Or, conditions
#   icon = ifelse(
      #   test = combined_df$data_type == "1 Outstanding",
      #   yes = "ion-android-star-outline",
      #   no = "ion-android-radio-button-off"
#   )
#   iconColor = 'white',
#   library = 'fa',
#   markerColor = getColor(df)
# )

icons <- awesomeIcons(
  icon = 'ios-close',
  iconColor = 'black',
  library = 'ion',
  markerColor = getColor(df)
)


popup_content <- paste0(
      "<h5>", df$name, "</h5>",
      
      "<table style='width:100%'>",
      
      "<tr>",
      "<th>Type</th>",
      "<td>", df$category, "</td>",
      "</tr>",
      
      "<tr>",
      "<tr>",
      "<th>Address</th>",
      "<td>", df$address, "</td>",
      "</tr>",
      
      "<tr>",
      "<th>image</th>",
      "<td> <img src='", df$img, "'></td>",
      "</tr>",
      
      "</table>"
)

map <- leaflet(df) %>% 
  addProviderTiles("CartoDB.Positron", group = "Positron (default)", 
                   layerId = "basetile") %>% 
  # Add data
  addAwesomeMarkers(
    ~lon, ~lat,
    popup = ~popup_content,
    label = ~name,
    icon=icons
  ) %>% 
  # Adds controls
  addFullscreenControl()
  # addLayersControl(
  #   baseGroups = c("Positron (default)", "OSM", "Toner", "Toner Lite"),
  #   overlayGroups = groups,
  #   options = layersControlOptions(collapsed = TRUE)
  # ) 
  # addLegend("bottomright", 
  #   colors =c("orange", "green", "red"),
  #   labels= c("Sale points", "Producers", "Other"),
  #   title= "Type of data",
  #   opacity = 1)  
  # addMiniMap(
  #   tiles = providers$CartoDB.Positron,
  #   toggleDisplay = TRUE ) 


map 

saveWidget(map, file = "alternative_trails_map_standalone.html")
```

